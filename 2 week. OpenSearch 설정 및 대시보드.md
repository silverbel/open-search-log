# OpenSearch ë„ë©”ì¸ ìƒì„±

ë„ë©”ì¸ì„ ìƒì„±í• ë•Œ ë°ì´í„° ë…¸ë“œì˜ ìŠ¤í™ì„ ì„¤ì •í•˜ê²Œ ë˜ëŠ”ë°, ë°ì´í„° ë…¸ë“œì— ëŒ€í•´ì„œ ë¬´ì—‡ì¸ì§€ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.

## ë°ì´í„° ë…¸ë“œ(Data Node)ë€?
OpenSearchì—ì„œ ë°ì´í„° ë…¸ë“œëŠ” ìƒ‰ì¸ëœ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³ , ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•µì‹¬ ë…¸ë“œì…ë‹ˆë‹¤.

- ë°ì´í„°ë¥¼ ë””ìŠ¤í¬ì— ì €ì¥(Lucene ì—”ì§„ ì‚¬ìš©)
- ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•˜ê³  ë°ì´í„°ë¥¼ ë°˜í™˜
- í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ìƒ¤ë“œ(Shard)ë¥¼ í˜¸ìŠ¤íŒ…í•˜ì—¬ ë°ì´í„°ë¥¼ ë¶„ì‚° ì €ì¥
ì¦‰, ë°ì´í„° ë…¸ë“œëŠ” DBì˜ ì €ì¥ì†Œì²˜ëŸ¼ ë™ì‘í•˜ì§€ë§Œ, ê²€ìƒ‰ ë° ë¶„ì„ì„ í•¨ê»˜ ìˆ˜í–‰í•˜ëŠ” ë…¸ë“œë¼ê³  ë³´ë©´ ë©ë‹ˆë‹¤.


### ë°ì´í„° ë…¸ë“œì™€ ì¼ë°˜ì ì¸ DBì™€ì˜ ì°¨ì´ì 
| íŠ¹ì§•               | OpenSearch ë°ì´í„° ë…¸ë“œ               | ì¼ë°˜ì ì¸ DB (ì˜ˆ: MySQL, PostgreSQL)     |
|--------------------|--------------------------------------|----------------------------------------|
| ë°ì´í„° ì €ì¥ ë°©ì‹    | ìƒ¤ë“œ(Shard)ë¡œ ë¶„ì‚° ì €ì¥              | í…Œì´ë¸”ê³¼ í–‰(Row) ê¸°ë°˜ ì €ì¥            |
| ê²€ìƒ‰ ì†ë„           | Inverted Index ê¸°ë°˜ ê²€ìƒ‰             | SQL ê¸°ë°˜ ê²€ìƒ‰                         |
| ì¿¼ë¦¬ ë°©ì‹           | OpenSearch DSL (ì˜ˆ: match, term)     | SQL (SELECT, JOIN ë“±)                 |
| í™•ì¥ì„±              | ì—¬ëŸ¬ ë…¸ë“œë¡œ ì‰½ê²Œ í™•ì¥ ê°€ëŠ¥           | Scale-outì´ ì–´ë µê±°ë‚˜ ì œì•½ì´ ìˆìŒ      |

## OpenSearch ë°ì´í„°ë…¸ë“œì˜ ìƒ¤ë“œ ì €ì¥ë°©ì‹

### ìƒ¤ë“œ(Shard)ë€?
- OpenSearchì—ì„œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê°€ì¥ ì‘ì€ ë‹¨ìœ„ì…ë‹ˆë‹¤.
- í•œ ê°œì˜ ì¸ë±ìŠ¤(Index)ëŠ” ì—¬ëŸ¬ ê°œì˜ ìƒ¤ë“œ(Shard)ë¡œ êµ¬ì„±ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- OpenSearchëŠ” ë°ì´í„°ë¥¼ ì—¬ëŸ¬ ê°œì˜ ìƒ¤ë“œë¡œ ë‚˜ëˆ„ì–´ ë¶„ì‚° ì €ì¥í•˜ê³  ê²€ìƒ‰ ì†ë„ë¥¼ ìµœì í™”í•©ë‹ˆë‹¤.

ğŸ“Œ ìƒ¤ë“œë¥¼ ì“°ëŠ” ì´ìœ ?
- ë°ì´í„° í¬ê¸°ê°€ ë„ˆë¬´ ì»¤ì§€ë©´ í•œ ê°œì˜ ì„œë²„(ë…¸ë“œ)ì— ì €ì¥í•˜ê¸° ì–´ë ¤ì›€
- ê²€ìƒ‰ ì†ë„ë¥¼ ë¹ ë¥´ê²Œ í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ë…¸ë“œì—ì„œ ë™ì‹œì— ê²€ìƒ‰ ê°€ëŠ¥
- í•˜ë‚˜ì˜ ì„œë²„ì— ì¥ì• ê°€ ë°œìƒí•´ë„ ë‹¤ë¥¸ ì„œë²„ì—ì„œ ë°ì´í„° ë³µêµ¬ ê°€ëŠ¥ (Replica Shard ì‚¬ìš©)

### ìƒ¤ë“œ ì €ì¥ ë°©ì‹ (ë¶„ì‚° ì €ì¥ êµ¬ì¡° ì˜ˆì‹œ)
| ë¬¸ì„œ ID | ìƒ¤ë“œ(Shard) ID |
|---------|----------------|
| Doc 1   | Shard 0        |
| Doc 2   | Shard 1        |
| Doc 3   | Shard 0        |
| Doc 4   | Shard 1        |
| Doc 5   | Shard 0        |
> Shard 0ì—ëŠ” Doc 1, Doc 3, Doc 5ê°€ ì €ì¥ë¨  
> Shard 1ì—ëŠ” Doc 2, Doc 4ê°€ ì €ì¥ë¨

### Primary Shardì™€ Replica Shard
**Primary Shard**ì™€ **Replica Shard** ë‘ ê°€ì§€ ì¢…ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.

**Primary Shard**
- ë°ì´í„°ë¥¼ ìµœì´ˆë¡œ ì €ì¥í•˜ëŠ” ì›ë³¸ ìƒ¤ë“œ
- ì¸ë±ìŠ¤ ìƒì„± ì‹œ ê³ ì • ê°œìˆ˜ë¡œ ì„¤ì • (ë‚˜ì¤‘ì— ë³€ê²½ ë¶ˆê°€)
- ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì—­í• 

**Replica Shard**
- Primary Shardì˜ ë°±ì—… ì—­í•  (ë°ì´í„° ì¤‘ë³µ ì €ì¥)
- Primary Shardì— ì¥ì• ê°€ ë°œìƒí•˜ë©´ Replica Shardê°€ ëŒ€ì‹  ì—­í•  ìˆ˜í–‰
- ê²€ìƒ‰ ìš”ì²­ ì‹œ ë¶€í•˜ ë¶„ì‚° ì—­í• ë„ ìˆ˜í–‰ (ê²€ìƒ‰ ì†ë„ í–¥ìƒ)

### Primary Shardì™€ Replica Shardë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ë¥¼ ì˜ˆì œë¥¼ ë“¤ì–´ ì•Œì•„ë´…ì‹œë‹¤!
| ìƒ¤ë“œ íƒ€ì…         | ë…¸ë“œ 1 | ë…¸ë“œ 2 | ë…¸ë“œ 3 |
|-------------------|--------|--------|--------|
| Primary Shard 0   | âœ…     | âŒ     | âŒ     |
| Primary Shard 1   | âŒ     | âœ…     | âŒ     |
| Replica Shard 0   | âŒ     | âŒ     | âœ…     |
| Replica Shard 1   | âŒ     | âœ…     | âœ…     |

- ë°ì´í„°ê°€ ê° ë…¸ë“œì— ë¶„ì‚° ì €ì¥ë˜ì–´ ë¹ ë¥¸ ê²€ìƒ‰ ê°€ëŠ¥
- í•œ ê°œì˜ ë…¸ë“œê°€ ì¥ì• ê°€ ë‚˜ë„ ë‹¤ë¥¸ ë…¸ë“œê°€ ë°ì´í„°ë¥¼ ìœ ì§€
â¡ ì•ˆì •ì„± + ì†ë„ ìµœì í™” íš¨ê³¼!

### ìƒ¤ë“œ ê°œìˆ˜ë¥¼ ì„¤ì •í•  ë•Œ ì£¼ì˜í•  ì 
- ìƒ¤ë“œ ê°œìˆ˜ëŠ” ë„ˆë¬´ ì ì–´ë„, ë„ˆë¬´ ë§ì•„ë„ ì•ˆ ì¢‹ìŒ!
- ë„ˆë¬´ ì ìœ¼ë©´? ë°ì´í„°ê°€ í•œ ë…¸ë“œì— ì§‘ì¤‘ë˜ì–´ ì¥ì•  ë°œìƒ ìœ„í—˜ ì¦ê°€
- ë„ˆë¬´ ë§ìœ¼ë©´? ë¶ˆí•„ìš”í•œ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ë¡œ ì„±ëŠ¥ ì €í•˜

ìƒ¤ë“œ ê°œìˆ˜ ì„¤ì • ê°€ì´ë“œ (gpt ë²„ì „..)
- ë°ì´í„° í¬ê¸°ê°€ ì‘ìœ¼ë©´ 1~3ê°œ ìƒ¤ë“œë¡œ ì„¤ì •
- ë°ì´í„° í¬ê¸°ê°€ í¬ë©´ 5~10ê°œ ìƒ¤ë“œë¡œ ì„¤ì • (ëŒ€ê·œëª¨ ë°ì´í„°ëŠ” 20+ ê°€ëŠ¥)
- Replica Shard ê°œìˆ˜ë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì„¤ì •í•˜ì—¬ ì•ˆì •ì„± ìœ ì§€

> Replica Shard ê°¯ìˆ˜ëŠ” ë‚˜ì¤‘ì— ìˆ˜ì •ê°€ëŠ¥í•˜ë‚˜ **Primary ShardëŠ” ë‚˜ì¤‘ì— ìˆ˜ì •ì´ ë¶ˆê°€**í•˜ì—¬ ì´ˆê¸° ì„¤ê³„ê°€ ì¤‘ìš”!!

## Inverted Index ê¸°ë°˜ ê²€ìƒ‰ì´ë€?
ë‹¨ì–´(í† í°) ë‹¨ìœ„ë¡œ ìƒ‰ì¸ì„ ìƒì„±í•˜ì—¬ ë¹ ë¥´ê²Œ ê²€ìƒ‰í•  ìˆ˜ ìˆë„ë¡ ë§Œë“  êµ¬ì¡°ì…ë‹ˆë‹¤.
```json
GET users/_search
{
  "query": {
    "match": {
      "name": "John"
    }
  }
}
```
- OpenSearchëŠ” name í•„ë“œì—ì„œ 'John'ì´ë¼ëŠ” ë‹¨ì–´(í† í°)ê°€ í¬í•¨ëœ ëª¨ë“  ë¬¸ì„œë¥¼ ë¹ ë¥´ê²Œ ì°¾ìŒ
- ë¬¸ì„œ ê¸°ë°˜ ê²€ìƒ‰ì´ë©°, ë¶€ë¶„ ê²€ìƒ‰, ìœ ì‚¬ ê²€ìƒ‰(ì˜ˆ: "John Doe") ë“±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

Inverted IndexëŠ” ê° ë‹¨ì–´(í† í°) ê¸°ì¤€ìœ¼ë¡œ ìƒ‰ì¸ì„ ìƒì„±í•©ë‹ˆë‹¤
| ë‹¨ì–´       | ë¬¸ì„œ ID ë¦¬ìŠ¤íŠ¸ |
|------------|----------------|
| Elasticsearch | 1, 3           |
| OpenSearch    | 3              |
| search        | 1, 2           |
| engine        | 1, 2           |
| eun      | 1              |
| silverbell           | 2              |
| fast          | 2              |
| lookup        | 2              |
"search"ë¼ëŠ” ë‹¨ì–´ê°€ í¬í•¨ëœ ëª¨ë“  ë¬¸ì„œ(1, 2)ë¥¼ ë°”ë¡œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


### Inverted Indexì˜ ì¥ì ê³¼ ë‹¨ì 
ì¥ì 
- ê²€ìƒ‰ ì†ë„ ê·¹ëŒ€í™”: ê²€ìƒ‰ ì‹œ ë¬¸ì„œ ì „ì²´ë¥¼ ì¡°íšŒí•˜ì§€ ì•Šê³  ë‹¨ì–´(í† í°) ê¸°ë°˜ìœ¼ë¡œ ë¹ ë¥´ê²Œ ê²€ìƒ‰
- ë¶€ë¶„ ê²€ìƒ‰ ê°€ëŠ¥: "search engine"ì„ ê²€ìƒ‰í•˜ë©´ "powerful search engine"ë„ ì°¾ì„ ìˆ˜ ìˆìŒ
- ìœ ì‚¬ ê²€ìƒ‰ ê°€ëŠ¥: "OpenSearch"ë¥¼ ê²€ìƒ‰í•˜ë©´ "Elasticsearch"ë„ ìœ ì‚¬ ê²€ìƒ‰ ê°€ëŠ¥ (ì˜ˆ: ë™ì˜ì–´ ì²˜ë¦¬)

ë‹¨ì 
- ìƒ‰ì¸ í¬ê¸°ê°€ ì»¤ì§ˆ ìˆ˜ ìˆìŒ: ëª¨ë“  ë‹¨ì–´(í† í°)ë§ˆë‹¤ ë³„ë„ ì €ì¥ë˜ë¯€ë¡œ ë°ì´í„° í¬ê¸°ê°€ ì»¤ì§ˆ ìˆ˜ ìˆìŒ
- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì„±ëŠ¥ì´ ë–¨ì–´ì§: ë¬¸ì„œê°€ ì¶”ê°€ë  ë•Œë§ˆë‹¤ Inverted Indexë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•˜ë¯€ë¡œ ëŠë¦´ ìˆ˜ ìˆìŒ

## ë°ì´í„° ë…¸ë“œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ íŒ¨ë°€ë¦¬
| ì¸ìŠ¤í„´ìŠ¤ íŒ¨ë°€ë¦¬  | CPU ìœ í˜•         | íŠ¹ì§•                                | ì í•©í•œ ì›Œí¬ë¡œë“œ           |
|------------------|------------------|-------------------------------------|---------------------------|
| R6g, R7g         | AWS Graviton     | ê³ ì„±ëŠ¥ ë©”ëª¨ë¦¬ ìµœì í™”, ì €ì „ë ¥        | ëŒ€ê·œëª¨ ì¸ë±ìŠ¤, ë¶„ì„       |
| R5, R6i, R7i     | Intel Xeon       | ì „í†µì ì¸ ë©”ëª¨ë¦¬ ìµœì í™”              | ë‹¤ì–‘í•œ ê²€ìƒ‰ ë° ë¶„ì„      |
| I3, I4i          | Intel Xeon       | ë¡œì»¬ NVMe SSD ì œê³µ                  | ê³ ì† ìƒ‰ì¸, ë†’ì€ IOPS í•„ìš” |
| M5, M6i, M7i     | Intel Xeon       | ê· í˜• ì¡íŒ ì„±ëŠ¥                      | ì¼ë°˜ì ì¸ ê²€ìƒ‰ ë° ë¶„ì„    |
| C5, C6i, C7i     | Intel Xeon       | ê³ ì„±ëŠ¥ ì»´í“¨íŒ… ìµœì í™”                | ë³µì¡í•œ ë¶„ì„, ML          |
| T3, T4g          | Intel/Graviton   | ì €ë ´í•œ ë²„ìŠ¤íŠ¸ ê°€ëŠ¥ ì„±ëŠ¥            | ì‘ì€ ê·œëª¨ì˜ ê²€ìƒ‰         |

> í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ì‚¬ìš©í• ê²ƒì´ê¸° ë•Œë¬¸ì— m7g.medium.search(general purpose)ë¥¼ ì±„íƒ!
